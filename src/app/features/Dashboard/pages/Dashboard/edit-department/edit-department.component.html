<section class="dashboard-content" dir="rtl">
  <div class="management-header">
    <h2>تعديل القسم</h2>
  </div>
  <form [formGroup]="departmentForm" (ngSubmit)="saveDepartment()">
    <div class="tabs">
      <div class="tab-headers">
        <button type="button" class="tab-header" [class.active]="activeTab === 'basic'" (click)="activeTab = 'basic'">
          <i class="pi pi-info-circle"></i> المعلومات الأساسية
        </button>
        <button type="button" class="tab-header" [class.active]="activeTab === 'programs'" (click)="activeTab = 'programs'">
          <i class="pi pi-graduation-cap"></i> البرامج
        </button>
        <button type="button" class="tab-header" [class.active]="activeTab === 'faculty'" (click)="activeTab = 'faculty'">
          <i class="pi pi-users"></i> أعضاء هيئة التدريس
        </button>
        <button type="button" class="tab-header" [class.active]="activeTab === 'activities'" (click)="activeTab = 'activities'">
          <i class="pi pi-calendar"></i> الأنشطة
        </button>
        <button type="button" class="tab-header" [class.active]="activeTab === 'contact'" (click)="activeTab = 'contact'">
          <i class="pi pi-phone"></i> التواصل
        </button>
      </div>
      <div class="tab-content" [class.active]="activeTab === 'basic'">
        <div class="form-grid">
          <div class="form-group">
            <label>اسم القسم *</label>
            <input 
              type="text" 
              class="form-control" 
              formControlName="name"
              placeholder="أدخل اسم القسم"
            >
          </div>
          <div class="form-group">
            <label>الاسم المختصر *</label>
            <input 
              type="text" 
              class="form-control" 
              formControlName="shortName"
              placeholder="أدخل الاسم المختصر"
            >
          </div>
          <div class="form-group full-width">
            <label>نظرة عامة *</label>
            <textarea 
              class="form-control" 
              formControlName="overview"
              rows="4"
              placeholder="أدخل نظرة عامة عن القسم"
            ></textarea>
          </div>
          <div class="form-group">
            <label>النوع</label>
            <select formControlName="type" class="form-control">
              <option value="">اختر النوع</option>
              <option *ngFor="let type of departmentTypes" [value]="type.value">
                {{ type.label }}
              </option>
            </select>
          </div>
          <div class="form-group">
            <label>سنة التأسيس</label>
            <input 
              type="text" 
              class="form-control" 
              formControlName="established"
              placeholder="مثال: 2016"
            >
          </div>
          <div class="form-group">
            <label>رابط الصورة</label>
            <input 
              type="url" 
              class="form-control" 
              formControlName="image"
              placeholder="أدخل رابط الصورة"
            >
          </div>
          <div class="form-group">
            <label>فئة الأيقونة</label>
            <input 
              type="text" 
              class="form-control" 
              formControlName="icon"
              placeholder="مثال: pi pi-book"
            >
          </div>
          <div class="form-group">
            <label>المسار</label>
            <input 
              type="text" 
              class="form-control" 
              formControlName="route"
              placeholder="مثال: /departments/english"
            >
          </div>
        </div>
      </div>

      <div class="tab-content" [class.active]="activeTab === 'programs'">
        <div class="programs-section">
          <div class="section-header">
            <h4>برامج القسم</h4>
            <button 
              type="button"
              class="btn-add-item"
              (click)="addProgram()"
            >
              <i class="pi pi-plus"></i>
              إضافة برنامج
            </button>
          </div>
          <div formArrayName="programs">
            <div 
              *ngFor="let program of programsArray.controls; let i = index"
              [formGroupName]="i"
              class="program-item"
            >
              <div class="item-header">
                <h5>البرنامج {{ i + 1 }}</h5>
                <button 
                  type="button"
                  class="btn-remove"
                  (click)="removeProgram(i)"
                >
                  <i class="pi pi-trash"></i>
                </button>
              </div>
              <div class="form-grid">
                <div class="form-group">
                  <label>اسم البرنامج</label>
                  <input type="text" class="form-control" formControlName="name">
                </div>
                <div class="form-group">
                  <label>المدة</label>
                  <input type="text" class="form-control" formControlName="duration">
                </div>
                <div class="form-group">
                  <label>الدرجة</label>
                  <input type="text" class="form-control" formControlName="degree">
                </div>
                <div class="form-group full-width">
                  <label>الوصف</label>
                  <textarea class="form-control" formControlName="description" rows="3"></textarea>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <div class="tab-content" [class.active]="activeTab === 'faculty'">
        <div class="faculty-section">
          <div class="section-header">
            <h4>أعضاء هيئة التدريس</h4>
            <button 
              type="button"
              class="btn-add-item"
              (click)="addFaculty()"
            >
              <i class="pi pi-plus"></i>
              إضافة عضو هيئة تدريس
            </button>
          </div>
          <div formArrayName="faculty">
            <div 
              *ngFor="let faculty of facultyArray.controls; let i = index"
              [formGroupName]="i"
              class="faculty-item"
            >
              <div class="item-header">
                <h5>عضو هيئة التدريس {{ i + 1 }}</h5>
                <button 
                  type="button"
                  class="btn-remove"
                  (click)="removeFaculty(i)"
                >
                  <i class="pi pi-trash"></i>
                </button>
              </div>
              <div class="form-grid">
                <div class="form-group">
                  <label>الاسم</label>
                  <input type="text" class="form-control" formControlName="name">
                </div>
                <div class="form-group">
                  <label>العنوان</label>
                  <input type="text" class="form-control" formControlName="title">
                </div>
                <div class="form-group">
                  <label>التخصص</label>
                  <input type="text" class="form-control" formControlName="specialization">
                </div>
                <div class="form-group">
                  <label>البريد الإلكتروني</label>
                  <input type="email" class="form-control" formControlName="email">
                </div>
                <div class="form-group full-width">
                  <label>رابط الصورة</label>
                  <input type="url" class="form-control" formControlName="photo">
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <div class="tab-content" [class.active]="activeTab === 'activities'">
        <div class="activities-section">
          <div class="section-header">
            <h4>أنشطة القسم</h4>
            <button 
              type="button"
              class="btn-add-item"
              (click)="addActivity()"
            >
              <i class="pi pi-plus"></i>
              إضافة نشاط
            </button>
          </div>
          <div formArrayName="activities">
            <div 
              *ngFor="let activity of activitiesArray.controls; let i = index"
              [formGroupName]="i"
              class="activity-item"
            >
              <div class="item-header">
                <h5>النشاط {{ i + 1 }}</h5>
                <button 
                  type="button"
                  class="btn-remove"
                  (click)="removeActivity(i)"
                >
                  <i class="pi pi-trash"></i>
                </button>
              </div>
              <div class="form-grid">
                <div class="form-group">
                  <label>العنوان</label>
                  <input type="text" class="form-control" formControlName="title">
                </div>
                <div class="form-group">
                  <label>التاريخ</label>
                  <input type="date" class="form-control" formControlName="date">
                </div>
                <div class="form-group full-width">
                  <label>الوصف</label>
                  <textarea class="form-control" formControlName="description" rows="3"></textarea>
                </div>
                <div class="form-group full-width">
                  <label>رابط الصورة</label>
                  <input type="url" class="form-control" formControlName="image">
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <div class="tab-content" [class.active]="activeTab === 'contact'">
        <div class="contact-section">
          <h4>معلومات التواصل</h4>
          <div formGroupName="contact" class="form-grid">
            <div class="form-group">
              <label>البريد الإلكتروني</label>
              <input type="email" class="form-control" formControlName="email">
            </div>
            <div class="form-group">
              <label>الهاتف</label>
              <input type="tel" class="form-control" formControlName="phone">
            </div>
            <div class="form-group">
              <label>المكتب</label>
              <input type="text" class="form-control" formControlName="office">
            </div>
            <div class="form-group">
              <label>رئيس القسم</label>
              <input type="text" class="form-control" formControlName="headOfDepartment">
            </div>
          </div>
        </div>
      </div>

      <div class="dialog-actions">
        <button 
          type="button"
          class="btn-outline-primary-custom"
          [routerLink]="['/dashboard/departments']"
        >
          إلغاء
        </button>
        <button 
          type="submit"
          class="btn-primary-custom"
          [disabled]="departmentForm.invalid"
        >
          تحديث القسم
        </button>
      </div>
    </div>
  </form>
</section>

<!-- Toast Messages -->
<div class="toast-container" *ngIf="showToast">
  <div class="toast" [class]="toastClass">
    <div class="toast-content">
      <i [class]="toastIcon"></i>
      <span>{{ toastMessage }}</span>
    </div>
    <button type="button" class="toast-close" (click)="hideToast()">×</button>
  </div>
</div>