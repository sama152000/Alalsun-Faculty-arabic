<div class="page-creator-container">
  <div class="creator-header">
    <h2>إنشاء صفحة جديدة</h2>
    <p>القالب: {{ getTemplateName() }}</p>
  </div>

  <form [formGroup]="pageForm" (ngSubmit)="onSubmit()">
    <div class="form-sections">
      <!-- المعلومات الأساسية -->
      <div class="form-section">
        <h3>المعلومات الأساسية</h3>
        <div class="form-grid">
          <div class="form-group">
            <label>عنوان الصفحة *</label>
            <input 
              type="text" 
              formControlName="title"
              placeholder="أدخل عنوان الصفحة"
              class="form-control"
            >
            <div *ngIf="pageForm.get('title')?.invalid && (pageForm.get('title')?.dirty || pageForm.get('title')?.touched)" class="error-message">
              عنوان الصفحة مطلوب
            </div>
          </div>
          <div class="form-group">
            <label>مسار الصفحة *</label>
            <input 
              type="text" 
              formControlName="route"
              placeholder="مثال: صفحتي-المخصصة"
              class="form-control"
            >
            <div *ngIf="pageForm.get('route')?.invalid && (pageForm.get('route')?.dirty || pageForm.get('route')?.touched)" class="error-message">
              <span *ngIf="pageForm.get('route')?.errors?.['required']">مسار الصفحة مطلوب</span>
              <span *ngIf="pageForm.get('route')?.errors?.['pattern']">يجب أن يحتوي المسار على أحرف أو أرقام أو شرطات أو شرطات سفلية فقط</span>
            </div>
          </div>
        </div>
      </div>

      <!-- المحتوى بناءً على القالب -->
      <div class="form-section" formGroupName="content">
        <h3>محتوى الصفحة</h3>
        
        <!-- قالب العنوان والنص -->
        <div *ngIf="templateId === 'title-text'" class="template-form">
          <div class="form-group">
            <label>العنوان الرئيسي *</label>
            <input 
              type="text" 
              formControlName="title"
              placeholder="أدخل العنوان الرئيسي"
              class="form-control"
            >
            <div *ngIf="pageForm.get('content.title')?.invalid && (pageForm.get('content.title')?.dirty || pageForm.get('content.title')?.touched)" class="error-message">
              العنوان الرئيسي مطلوب
            </div>
          </div>
          <div class="form-group">
            <label>نص المحتوى *</label>
            <textarea 
              formControlName="text"
              rows="8"
              placeholder="أدخل محتواك هنا..."
              class="form-control"
            ></textarea>
            <div *ngIf="pageForm.get('content.text')?.invalid && (pageForm.get('content.text')?.dirty || pageForm.get('content.text')?.touched)" class="error-message">
              نص المحتوى مطلوب
            </div>
          </div>
        </div>

        <!-- قالب الصورة، العنوان والنص -->
        <div *ngIf="templateId === 'image-title-text'" class="template-form">
          <div class="form-group">
            <label>العنوان الرئيسي *</label>
            <input 
              type="text" 
              formControlName="title"
              placeholder="أدخل العنوان الرئيسي"
              class="form-control"
            >
            <div *ngIf="pageForm.get('content.title')?.invalid && (pageForm.get('content.title')?.dirty || pageForm.get('content.title')?.touched)" class="error-message">
              العنوان الرئيسي مطلوب
            </div>
          </div>
          <div class="form-group">
            <label>رابط الصورة *</label>
            <input 
              type="url" 
              formControlName="image"
              placeholder="أدخل رابط الصورة"
              class="form-control"
            >
            <div *ngIf="pageForm.get('content.image')?.invalid && (pageForm.get('content.image')?.dirty || pageForm.get('content.image')?.touched)" class="error-message">
              رابط الصورة مطلوب
            </div>
          </div>
          <div class="form-group">
            <label>نص المحتوى *</label>
            <textarea 
              formControlName="text"
              rows="6"
              placeholder="أدخل محتواك هنا..."
              class="form-control"
            ></textarea>
            <div *ngIf="pageForm.get('content.text')?.invalid && (pageForm.get('content.text')?.dirty || pageForm.get('content.text')?.touched)" class="error-message">
              نص المحتوى مطلوب
            </div>
          </div>
        </div>

        <!-- قالب البطاقات -->
        <div *ngIf="templateId === 'cards'" class="template-form">
          <div class="form-group">
            <label>عنوان القسم *</label>
            <input 
              type="text" 
              formControlName="title"
              placeholder="أدخل عنوان القسم"
              class="form-control"
            >
            <div *ngIf="pageForm.get('content.title')?.invalid && (pageForm.get('content.title')?.dirty || pageForm.get('content.title')?.touched)" class="error-message">
              عنوان القسم مطلوب
            </div>
          </div>
          
          <div class="cards-section">
            <div class="section-header">
              <h4>بطاقات المحتوى</h4>
              <button 
                type="button"
                class="btn-add-card"
                (click)="addCard()"
              >
                <i class="pi pi-plus"></i>
                أضف بطاقة
              </button>
            </div>
            
            <div formArrayName="cards">
              <div 
                *ngFor="let card of cardsArray.controls; let i = index"
                [formGroupName]="i"
                class="card-form"
              >
                <div class="card-header">
                  <h5>بطاقة {{ i + 1 }}</h5>
                  <button 
                    type="button"
                    class="btn-remove-card"
                    (click)="removeCard(i)"
                  >
                    <i class="pi pi-trash"></i>
                  </button>
                </div>
                <div class="form-grid">
                  <div class="form-group">
                    <label>عنوان البطاقة</label>
                    <input 
                      type="text" 
                      formControlName="title"
                      placeholder="أدخل عنوان البطاقة"
                      class="form-control"
                    >
                    <div *ngIf="cardsArray.controls[i].get('title')?.invalid && (cardsArray.controls[i].get('title')?.dirty || cardsArray.controls[i].get('title')?.touched)" class="error-message">
                      عنوان البطاقة مطلوب
                    </div>
                  </div>
                  <div class="form-group">
                    <label>رابط البطاقة (اختياري)</label>
                    <input 
                      type="text" 
                      formControlName="link"
                      placeholder="أدخل رابط URL"
                      class="form-control"
                    >
                  </div>
                  <div class="form-group full-width">
                    <label>وصف البطاقة</label>
                    <textarea 
                      formControlName="description"
                      rows="3"
                      placeholder="أدخل وصف البطاقة"
                      class="form-control"
                    ></textarea>
                    <div *ngIf="cardsArray.controls[i].get('description')?.invalid && (cardsArray.controls[i].get('description')?.dirty || cardsArray.controls[i].get('description')?.touched)" class="error-message">
                      وصف البطاقة مطلوب
                    </div>
                  </div>
                  <div class="form-group full-width">
                    <label>رابط صورة البطاقة (اختياري)</label>
                    <input 
                      type="url" 
                      formControlName="image"
                      placeholder="أدخل رابط الصورة"
                      class="form-control"
                    >
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="form-actions">
      <button 
        type="button"
        class="btn-outline-primary-custom"
        (click)="goBack()"
      >
        <i class="pi pi-arrow-left"></i>
        رجوع
      </button>
      <button 
        type="submit"
        class="btn-primary-custom"
        [disabled]="pageForm.invalid"
      >
        <i class="pi pi-eye"></i>
        معاينة الصفحة
      </button>
    </div>
  </form>
</div>