<div class="edit-menu-container" dir="rtl">
  <div class="page-header">
    <div class="header-content">
      <div class="header-info">
        <h1 class="page-title">تعديل القائمة</h1>
        <p class="page-description">تعديل إعدادات القائمة المختارة</p>
      </div>
      <div class="header-actions">
        <button pButton type="button" class="p-button-text p-button-secondary" [routerLink]="['/dashboard/menus']">
          <i class="pi pi-arrow-right"></i>
          <span>العودة إلى القوائم</span>
        </button>
      </div>
    </div>
  </div>

  <!-- Loading Indicator -->
  <div *ngIf="isLoading" class="loading-container text-center">
    <div class="loading-spinner">
      <i class="pi pi-spin pi-spinner" style="font-size: 2rem;"></i>
      <p>جارٍ تحميل البيانات...</p>
    </div>
  </div>

  <form [formGroup]="menuForm" (ngSubmit)="updateMenu()" class="menu-form" *ngIf="!isLoading">
    <!-- Toast Notifications -->
    <p-toast position="top-right"></p-toast>

    <!-- Basic Information -->
    <div class="form-section card shadow-sm">
      <div class="section-header card-header">
        <h2>المعلومات الأساسية</h2>
        <p>تعديل التفاصيل الأساسية للقائمة</p>
      </div>
      
      <div class="card-body">
        <div class="row g-3">
          <div class="col-md-6">
            <label for="name" class="form-label">اسم القائمة *</label>
            <input 
              id="name"
              type="text" 
              class="form-control" 
              [class.is-invalid]="isFieldInvalid('name')"
              formControlName="name"
              placeholder="مثال: القائمة الرئيسية 2025"
            >
            <div class="invalid-feedback" *ngIf="isFieldInvalid('name')">
              {{ getFieldError('name') }}
            </div>
          </div>

          <div class="col-md-3">
            <label for="type" class="form-label">نوع القائمة *</label>
            <select 
              id="type"
              class="form-select" 
              [class.is-invalid]="isFieldInvalid('type')"
              formControlName="type"
            >
              <option value="" disabled>اختر نوع القائمة</option>
              <option value="header">قائمة الرأس</option>
              <option value="footer">قائمة التذييل</option>
            </select>
            <div class="invalid-feedback" *ngIf="isFieldInvalid('type')">
              {{ getFieldError('type') }}
            </div>
          </div>

          <div class="col-md-3" *ngIf="menuForm.get('type')?.value === 'header'">
            <label for="headerType" class="form-label">نوع قائمة الرأس *</label>
            <select 
              id="headerType"
              class="form-select" 
              [class.is-invalid]="isFieldInvalid('headerType')"
              formControlName="headerType"
            >
              <option value="" disabled>اختر نوع قائمة الرأس</option>
              <option value="top_nav">التنقل العلوي</option>
              <option value="main_nav">التنقل الرئيسي</option>
              <option value="submenu">القائمة الفرعية</option>
            </select>
            <div class="invalid-feedback" *ngIf="isFieldInvalid('headerType')">
              {{ getFieldError('headerType') }}
            </div>
          </div>

          <div class="col-md-3">
            <div class="form-check mt-4">
              <input 
                id="isActive"
                type="checkbox" 
                class="form-check-input"
                formControlName="isActive"
              >
              <label for="isActive" class="form-check-label">تفعيل القائمة</label>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Faculty Information (Top Navigation) -->
    <div class="form-section card shadow-sm" *ngIf="menuForm.get('type')?.value === 'header' && menuForm.get('headerType')?.value === 'top_nav'">
      <div class="section-header card-header">
        <h2>معلومات الكلية</h2>
        <p>تعديل تفاصيل الكلية للتنقل العلوي</p>
      </div>
      
      <div class="card-body" formGroupName="facultyInfo">
        <div class="row g-3">
          <div class="col-md-6">
            <label for="facultyName" class="form-label">اسم الكلية</label>
            <input 
              id="facultyName"
              type="text" 
              class="form-control" 
              formControlName="name"
              placeholder="كلية الألسن"
            >
          </div>
          <div class="col-md-6">
            <label for="subtitle" class="form-label">العنوان الفرعي</label>
            <input 
              id="subtitle"
              type="text" 
              class="form-control" 
              formControlName="subtitle"
              placeholder="جامعة الأقصر"
            >
          </div>
          <div class="col-md-6">
            <label for="universityName" class="form-label">اسم الجامعة</label>
            <input 
              id="universityName"
              type="text" 
              class="form-control" 
              formControlName="universityName"
              placeholder="جامعة الأقصر"
            >
          </div>
          <div class="col-md-6">
            <label for="established" class="form-label">سنة التأسيس</label>
            <input 
              id="established"
              type="text" 
              class="form-control" 
              formControlName="established"
              placeholder="2019"
            >
          </div>
        </div>
      </div>
    </div>

    <!-- Navigation Items (Main Navigation) -->
    <div class="form-section card shadow-sm" *ngIf="menuForm.get('type')?.value === 'header' && menuForm.get('headerType')?.value === 'main_nav'">
      <div class="section-header card-header">
        <h2>عناصر التنقل</h2>
        <p>تعديل عناصر التنقل الرئيسية والفرعية</p>
        <button pButton type="button" class="p-button-outlined p-button-sm" (click)="addNavbarItem()">
          <i class="pi pi-plus"></i>
          <span>إضافة عنصر تنقل</span>
        </button>
      </div>
      
      <div class="card-body" formArrayName="navbarItems">
        <div *ngFor="let item of navbarItemsArray.controls; let i = index" [formGroupName]="i" class="item-card card mb-3">
          <div class="item-header card-header d-flex justify-content-between align-items-center">
            <div class="item-info">
              <h3 class="h5 mb-0">عنصر التنقل {{ i + 1 }}</h3>
              <span class="item-type text-muted">عنصر رئيسي</span>
            </div>
            <button pButton type="button" class="p-button-text p-button-danger p-button-sm" (click)="removeNavbarItem(i)">
              <i class="pi pi-trash"></i>
            </button>
          </div>
          
          <div class="card-body">
            <div class="row g-3">
              <div class="col-md-4">
                <label class="form-label">النص المعروض *</label>
                <input 
                  type="text" 
                  class="form-control" 
                  formControlName="label"
                  placeholder="مثال: الرئيسية، عن الكلية"
                >
              </div>
              <div class="col-md-4">
                <label class="form-label">الرابط</label>
                <input 
                  type="text" 
                  class="form-control" 
                  formControlName="route"
                  placeholder="مثال: /home، /about"
                >
              </div>
              <div class="col-md-4">
                <label class="form-label">هدف الرابط</label>
                <select class="form-select" formControlName="target">
                  <option value="">نفس النافذة</option>
                  <option value="_blank">نافذة جديدة</option>
                  <option value="_self">نفس الإطار</option>
                  <option value="_parent">الإطار الأب</option>
                </select>
              </div>
            </div>

            <!-- Children Items -->
            <div class="children-section mt-4">
              <div class="section-header d-flex justify-content-between align-items-center">
                <h4>العناصر الفرعية</h4>
                <button pButton type="button" class="p-button-outlined p-button-sm" (click)="addNavbarChild(i)">
                  <i class="pi pi-plus"></i>
                  <span>إضافة عنصر فرعي</span>
                </button>
              </div>
              
              <div formArrayName="children" class="children-container">
                <div *ngFor="let child of getNavbarChildrenArray(i).controls; let j = index" [formGroupName]="j" class="child-item card mb-2">
                  <div class="item-header card-header d-flex justify-content-between align-items-center">
                    <div class="item-info">
                      <h5 class="mb-0">العنصر الفرعي {{ j + 1 }}</h5>
                      <span class="item-type text-muted">عنصر فرعي</span>
                    </div>
                    <button pButton type="button" class="p-button-text p-button-danger p-button-sm" (click)="removeNavbarChild(i, j)">
                      <i class="pi pi-times"></i>
                    </button>
                  </div>
                  <div class="card-body">
                    <div class="row g-3">
                      <div class="col-md-4">
                        <label class="form-label">النص المعروض *</label>
                        <input 
                          type="text" 
                          class="form-control" 
                          formControlName="label"
                          placeholder="مثال: قطاع التعليم"
                        >
                      </div>
                      <div class="col-md-4">
                        <label class="form-label">الرابط</label>
                        <input 
                          type="text" 
                          class="form-control" 
                          formControlName="route"
                          placeholder="مثال: /sectors/education"
                        >
                      </div>
                      <div class="col-md-4">
                        <label class="form-label">هدف الرابط</label>
                        <select class="form-select" formControlName="target">
                          <option value="">نفس النافذة</option>
                          <option value="_blank">نافذة جديدة</option>
                          <option value="_self">نفس الإطار</option>
                          <option value="_parent">الإطار الأب</option>
                        </select>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Submenu Configuration -->
    <div class="form-section card shadow-sm" *ngIf="menuForm.get('type')?.value === 'header' && menuForm.get('headerType')?.value === 'submenu'">
      <div class="section-header card-header">
        <h2>إعدادات القائمة الفرعية</h2>
        <p>تعديل إعدادات القائمة الفرعية ومعلومات الاتصال</p>
      </div>
      
      <div class="card-body" formGroupName="submenu">
        <div class="row g-3">
          <div class="col-12">
            <label for="copyright" class="form-label">نص حقوق الطبع</label>
            <input 
              id="copyright"
              type="text" 
              class="form-control" 
              formControlName="copyright"
              placeholder="© 2025 كلية الألسن. جميع الحقوق محفوظة."
            >
          </div>
        </div>
        
        <h3 class="mt-4">طرق التواصل</h3>
        <div formGroupName="contactMethods" class="row g-3">
          <div class="col-md-4">
            <label for="phone" class="form-label">الهاتف</label>
            <input 
              id="phone"
              type="tel" 
              class="form-control" 
              formControlName="phone"
              placeholder="+20 95 237 1000"
            >
          </div>
          <div class="col-md-4">
            <label for="email" class="form-label">البريد الإلكتروني</label>
            <input 
              id="email"
              type="email" 
              class="form-control" 
              formControlName="email"
              placeholder="info@alsun.luxor.edu.eg"
            >
          </div>
          <div class="col-md-4">
            <label for="universityWebsite" class="form-label">موقع الجامعة</label>
            <input 
              id="universityWebsite"
              type="url" 
              class="form-control" 
              formControlName="universityWebsite"
              placeholder="https://luxor.edu.eg"
            >
          </div>
        </div>

        <!-- Languages -->
        <div class="subsection mt-4">
          <div class="section-header d-flex justify-content-between align-items-center">
            <h3>اللغات المتاحة</h3>
            <button pButton type="button" class="p-button-outlined p-button-sm" (click)="addSubmenuLanguage()">
              <i class="pi pi-plus"></i>
              <span>إضافة لغة</span>
            </button>
          </div>
          <div formArrayName="languages" class="languages-container">
            <div *ngFor="let lang of submenuLanguagesArray.controls; let i = index" [formGroupName]="i" class="language-item card mb-2">
              <div class="item-header card-header d-flex justify-content-between align-items-center">
                <h4 class="mb-0">اللغة {{ i + 1 }}</h4>
                <button pButton type="button" class="p-button-text p-button-danger p-button-sm" (click)="removeSubmenuLanguage(i)">
                  <i class="pi pi-trash"></i>
                </button>
              </div>
              <div class="card-body">
                <div class="row g-3">
                  <div class="col-md-6">
                    <label class="form-label">الرمز *</label>
                    <input 
                      type="text" 
                      class="form-control" 
                      formControlName="value"
                      placeholder="مثال: ar"
                    >
                  </div>
                  <div class="col-md-6">
                    <label class="form-label">الاسم *</label>
                    <input 
                      type="text" 
                      class="form-control" 
                      formControlName="label"
                      placeholder="مثال: العربية"
                    >
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Footer Configuration -->
    <div class="form-section card shadow-sm" *ngIf="menuForm.get('type')?.value === 'footer'">
      <div class="section-header card-header">
        <h2>إعدادات التذييل</h2>
        <p>تعديل إعدادات التذييل وروابط وسائل التواصل الاجتماعي</p>
      </div>
      
      <div class="card-body" formGroupName="footerData">
        <!-- Basic Footer Info -->
        <div class="subsection">
          <h3>المعلومات الأساسية</h3>
          <div class="row g-3">
            <div class="col-md-6">
              <label for="footerTitle" class="form-label">العنوان</label>
              <input 
                id="footerTitle"
                type="text" 
                class="form-control" 
                formControlName="title"
                placeholder="كلية الألسن"
              >
            </div>
            <div class="col-md-6">
              <label for="footerSubtitle" class="form-label">العنوان الفرعي</label>
              <input 
                id="footerSubtitle"
                type="text" 
                class="form-control" 
                formControlName="subtitle"
                placeholder="جامعة الأقصر"
              >
            </div>
            <div class="col-md-6">
              <label for="tagline" class="form-label">الشعار</label>
              <input 
                id="tagline"
                type="text" 
                class="form-control" 
                formControlName="tagline"
                placeholder="التميز في تعليم اللغات"
              >
            </div>
            <div class="col-md-6">
              <label for="footerCopyright" class="form-label">حقوق الطبع</label>
              <input 
                id="footerCopyright"
                type="text" 
                class="form-control" 
                formControlName="copyright"
                placeholder="© 2025 كلية الألسن. جميع الحقوق محفوظة."
              >
            </div>
          </div>
        </div>

        <!-- Social Media Links -->
        <div class="subsection mt-4">
          <div class="section-header d-flex justify-content-between align-items-center">
            <h3>روابط وسائل التواصل الاجتماعي</h3>
            <button pButton type="button" class="p-button-outlined p-button-sm" (click)="addFooterSocialLink()">
              <i class="pi pi-plus"></i>
              <span>إضافة رابط اجتماعي</span>
            </button>
          </div>
          <div formArrayName="socialLinks" class="social-links-container">
            <div *ngFor="let link of footerSocialLinksArray.controls; let i = index" [formGroupName]="i" class="social-link-item card mb-2">
              <div class="item-header card-header d-flex justify-content-between align-items-center">
                <h4 class="mb-0">رابط اجتماعي {{ i + 1 }}</h4>
                <button pButton type="button" class="p-button-text p-button-danger p-button-sm" (click)="removeFooterSocialLink(i)">
                  <i class="pi pi-trash"></i>
                </button>
              </div>
              <div class="card-body">
                <div class="row g-3">
                  <div class="col-md-3">
                    <label class="form-label">المنصة *</label>
                    <input 
                      type="text" 
                      class="form-control" 
                      formControlName="platform"
                      placeholder="مثال: فيسبوك"
                    >
                  </div>
                  <div class="col-md-3">
                    <label class="form-label">الرابط *</label>
                    <input 
                      type="url" 
                      class="form-control" 
                      formControlName="url"
                      placeholder="مثال: https://facebook.com/page"
                    >
                  </div>
                  <div class="col-md-3">
                    <label class="form-label">الأيقونة *</label>
                    <select class="form-select" formControlName="icon">
                      <option value="" disabled>اختر الأيقونة</option>
                      <option *ngFor="let icon of socialIcons" [value]="icon.value">
                        {{ icon.label }}
                      </option>
                    </select>
                  </div>
                  <div class="col-md-3">
                    <label class="form-label">هدف الرابط</label>
                    <select class="form-select" formControlName="target">
                      <option value="">نفس النافذة</option>
                      <option value="_blank">نافذة جديدة</option>
                      <option value="_self">نفس الإطار</option>
                      <option value="_parent">الإطار الأب</option>
                    </select>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Quick Links -->
        <div class="subsection mt-4">
          <div class="section-header d-flex justify-content-between align-items-center">
            <h3>الروابط السريعة</h3>
            <button pButton type="button" class="p-button-outlined p-button-sm" (click)="addFooterQuickLink()">
              <i class="pi pi-plus"></i>
              <span>إضافة رابط سريع</span>
            </button>
          </div>
          <div formGroupName="quickLinks">
            <div class="row g-3 mb-3">
              <div class="col-12">
                <label for="quickLinksTitle" class="form-label">عنوان القسم</label>
                <input 
                  id="quickLinksTitle"
                  type="text" 
                  class="form-control" 
                  formControlName="title"
                  placeholder="روابط سريعة"
                >
              </div>
            </div>
            <div formArrayName="links" class="links-container">
              <div *ngFor="let link of footerQuickLinksArray.controls; let i = index" [formGroupName]="i" class="link-item card mb-2">
                <div class="item-header card-header d-flex justify-content-between align-items-center">
                  <h4 class="mb-0">رابط {{ i + 1 }}</h4>
                  <button pButton type="button" class="p-button-text p-button-danger p-button-sm" (click)="removeFooterQuickLink(i)">
                    <i class="pi pi-trash"></i>
                  </button>
                </div>
                <div class="card-body">
                  <div class="row g-3">
                    <div class="col-md-4">
                      <label class="form-label">العنوان *</label>
                      <input 
                        type="text" 
                        class="form-control" 
                        formControlName="title"
                        placeholder="مثال: عن الكلية"
                      >
                    </div>
                    <div class="col-md-4">
                      <label class="form-label">الرابط *</label>
                      <input 
                        type="text" 
                        class="form-control" 
                        formControlName="url"
                        placeholder="مثال: /about"
                      >
                    </div>
                    <div class="col-md-4">
                      <label class="form-label">هدف الرابط</label>
                      <select class="form-select" formControlName="target">
                        <option value="">نفس النافذة</option>
                        <option value="_blank">نافذة جديدة</option>
                        <option value="_self">نفس الإطار</option>
                        <option value="_parent">الإطار الأب</option>
                      </select>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Academic Links -->
        <div class="subsection mt-4">
          <div class="section-header d-flex justify-content-between align-items-center">
            <h3>الروابط الأكاديمية</h3>
            <button pButton type="button" class="p-button-outlined p-button-sm" (click)="addFooterAcademicLink()">
              <i class="pi pi-plus"></i>
              <span>إضافة رابط أكاديمي</span>
            </button>
          </div>
          <div formGroupName="academicLinks">
            <div class="row g-3 mb-3">
              <div class="col-12">
                <label for="academicLinksTitle" class="form-label">عنوان القسم</label>
                <input 
                  id="academicLinksTitle"
                  type="text" 
                  class="form-control" 
                  formControlName="title"
                  placeholder="الروابط الأكاديمية"
                >
              </div>
            </div>
            <div formArrayName="links" class="links-container">
              <div *ngFor="let link of footerAcademicLinksArray.controls; let i = index" [formGroupName]="i" class="link-item card mb-2">
                <div class="item-header card-header d-flex justify-content-between align-items-center">
                  <h4 class="mb-0">رابط {{ i + 1 }}</h4>
                  <button pButton type="button" class="p-button-text p-button-danger p-button-sm" (click)="removeFooterAcademicLink(i)">
                    <i class="pi pi-trash"></i>
                  </button>
                </div>
                <div class="card-body">
                  <div class="row g-3">
                    <div class="col-md-4">
                      <label class="form-label">العنوان *</label>
                      <input 
                        type="text" 
                        class="form-control" 
                        formControlName="title"
                        placeholder="مثال: الدراسات العليا"
                      >
                    </div>
                    <div class="col-md-4">
                      <label class="form-label">الرابط *</label>
                      <input 
                        type="text" 
                        class="form-control" 
                        formControlName="url"
                        placeholder="مثال: /postgraduate"
                      >
                    </div>
                    <div class="col-md-4">
                      <label class="form-label">هدف الرابط</label>
                      <select class="form-select" formControlName="target">
                        <option value="">نفس النافذة</option>
                        <option value="_blank">نافذة جديدة</option>
                        <option value="_self">نفس الإطار</option>
                        <option value="_parent">الإطار الأب</option>
                      </select>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Resource Links -->
        <div class="subsection mt-4">
          <div class="section-header d-flex justify-content-between align-items-center">
            <h3>روابط الموارد</h3>
            <button pButton type="button" class="p-button-outlined p-button-sm" (click)="addFooterResourceLink()">
              <i class="pi pi-plus"></i>
              <span>إضافة رابط مورد</span>
            </button>
          </div>
          <div formGroupName="resourceLinks">
            <div class="row g-3 mb-3">
              <div class="col-12">
                <label for="resourceLinksTitle" class="form-label">عنوان القسم</label>
                <input 
                  id="resourceLinksTitle"
                  type="text" 
                  class="form-control" 
                  formControlName="title"
                  placeholder="الموارد"
                >
              </div>
            </div>
            <div formArrayName="links" class="links-container">
              <div *ngFor="let link of footerResourceLinksArray.controls; let i = index" [formGroupName]="i" class="link-item card mb-2">
                <div class="item-header card-header d-flex justify-content-between align-items-center">
                  <h4 class="mb-0">رابط {{ i + 1 }}</h4>
                  <button pButton type="button" class="p-button-text p-button-danger p-button-sm" (click)="removeFooterResourceLink(i)">
                    <i class="pi pi-trash"></i>
                  </button>
                </div>
                <div class="card-body">
                  <div class="row g-3">
                    <div class="col-md-4">
                      <label class="form-label">العنوان *</label>
                      <input 
                        type="text" 
                        class="form-control" 
                        formControlName="title"
                        placeholder="مثال: المكتبة"
                      >
                    </div>
                    <div class="col-md-4">
                      <label class="form-label">الرابط *</label>
                      <input 
                        type="text" 
                        class="form-control" 
                        formControlName="url"
                        placeholder="مثال: /library"
                      >
                    </div>
                    <div class="col-md-4">
                      <label class="form-label">هدف الرابط</label>
                      <select class="form-select" formControlName="target">
                        <option value="">نفس النافذة</option>
                        <option value="_blank">نافذة جديدة</option>
                        <option value="_self">نفس الإطار</option>
                        <option value="_parent">الإطار الأب</option>
                      </select>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Form Actions -->
    <div class="form-actions mt-4 d-flex justify-content-end gap-3">
      <button pButton type="button" class="p-button-outlined p-button-secondary" [routerLink]="['/dashboard/menus']">
        <i class="pi pi-times"></i>
        <span>إلغاء</span>
      </button>
      <button pButton type="submit" class="p-button p-button-primary" [disabled]="menuForm.invalid">
        <i class="pi pi-check"></i>
        <span>حفظ التغييرات</span>
      </button>
    </div>
  </form>
</div>