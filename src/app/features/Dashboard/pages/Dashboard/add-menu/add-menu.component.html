<div class="add-menu-container">
  <div class="page-header">
    <div class="header-content">
      <div class="header-info">
        <h1 class="page-title">إضافة قائمة جديدة</h1>
        <p class="page-description">قم بإنشاء قائمة جديدة لموقعك الإلكتروني</p>
      </div>
      <div class="header-actions">
        <button type="button" class="btn-secondary" [routerLink]="['/dashboard/menus']">
          <i class="pi pi-arrow-left"></i>
          <span>العودة للقوائم</span>
        </button>
      </div>
    </div>
  </div>

  <form [formGroup]="menuForm" (ngSubmit)="saveMenu()" class="menu-form">
    <!-- Basic Information -->
    <div class="form-section">
      <div class="section-header">
        <h2>المعلومات الأساسية</h2>
        <p>أدخل التفاصيل الأساسية للقائمة الجديدة</p>
      </div>
      
      <div class="form-grid">
        <div class="form-group">
          <label for="name">اسم القائمة *</label>
          <input 
            id="name"
            type="text" 
            class="form-control" 
            [class.is-invalid]="isFieldInvalid('name')"
            formControlName="name"
            placeholder="مثال: القائمة الرئيسية 2025"
          >
          <div class="invalid-feedback" *ngIf="isFieldInvalid('name')">
            {{ getFieldError('name') }}
          </div>
        </div>

        <div class="form-group">
          <label for="type">نوع القائمة *</label>
          <select 
            id="type"
            class="form-control" 
            [class.is-invalid]="isFieldInvalid('type')"
            formControlName="type"
          >
            <option value="">اختر نوع القائمة</option>
            <option value="header">قائمة الرأس</option>
            <option value="footer">قائمة التذييل</option>
          </select>
          <div class="invalid-feedback" *ngIf="isFieldInvalid('type')">
            {{ getFieldError('type') }}
          </div>
        </div>

        <div class="form-group" *ngIf="menuForm.get('type')?.value === 'header'">
          <label for="headerType">نوع قائمة الرأس *</label>
          <select 
            id="headerType"
            class="form-control" 
            [class.is-invalid]="isFieldInvalid('headerType')"
            formControlName="headerType"
          >
            <option value="">اختر نوع قائمة الرأس</option>
            <option value="top_nav">التنقل العلوي</option>
            <option value="main_nav">التنقل الرئيسي</option>
            <option value="submenu">القائمة الفرعية</option>
          </select>
          <div class="invalid-feedback" *ngIf="isFieldInvalid('headerType')">
            {{ getFieldError('headerType') }}
          </div>
        </div>

        <div class="form-group">
          <div class="form-check">
            <input 
              id="isActive"
              type="checkbox" 
              class="form-check-input"
              formControlName="isActive"
            >
            <label for="isActive" class="form-check-label">تفعيل القائمة</label>
          </div>
        </div>
      </div>
    </div>

    <!-- Faculty Information (Top Navigation) -->
    <div class="form-section" *ngIf="menuForm.get('type')?.value === 'header' && menuForm.get('headerType')?.value === 'top_nav'">
      <div class="section-header">
        <h2>معلومات الكلية</h2>
        <p>أدخل معلومات الكلية للتنقل العلوي</p>
      </div>
      
      <div class="form-grid" formGroupName="facultyInfo">
        <div class="form-group">
          <label for="facultyName">اسم الكلية</label>
          <input 
            id="facultyName"
            type="text" 
            class="form-control" 
            formControlName="name"
            placeholder="كلية الألسن"
          >
        </div>
        <div class="form-group">
          <label for="subtitle">العنوان الفرعي</label>
          <input 
            id="subtitle"
            type="text" 
            class="form-control" 
            formControlName="subtitle"
            placeholder="جامعة الأقصر"
          >
        </div>
        <div class="form-group">
          <label for="universityName">اسم الجامعة</label>
          <input 
            id="universityName"
            type="text" 
            class="form-control" 
            formControlName="universityName"
            placeholder="جامعة الأقصر"
          >
        </div>
        <div class="form-group">
          <label for="established">سنة التأسيس</label>
          <input 
            id="established"
            type="text" 
            class="form-control" 
            formControlName="established"
            placeholder="2019"
          >
        </div>
      </div>
    </div>

    <!-- Navigation Items (Main Navigation) -->
    <div class="form-section" *ngIf="menuForm.get('type')?.value === 'header' && menuForm.get('headerType')?.value === 'main_nav'">
      <div class="section-header">
        <h2>عناصر التنقل</h2>
        <p>أضف عناصر التنقل الرئيسية. يمكنك إضافة عناصر فرعية لأي عنصر رئيسي</p>
        <button type="button" class="btn-add" (click)="addNavbarItem()">
          <i class="pi pi-plus"></i>
          <span>إضافة عنصر تنقل</span>
        </button>
      </div>
      
      <div formArrayName="navbarItems" class="items-container">
        <div *ngFor="let item of navbarItemsArray.controls; let i = index" [formGroupName]="i" class="item-card">
          <div class="item-header">
            <div class="item-info">
              <h3>عنصر التنقل {{ i + 1 }}</h3>
              <span class="item-type">عنصر رئيسي</span>
            </div>
            <button type="button" class="btn-remove" (click)="removeNavbarItem(i)">
              <i class="pi pi-trash"></i>
            </button>
          </div>
          
          <div class="form-grid">
            <div class="form-group">
              <label>النص المعروض *</label>
              <input 
                type="text" 
                class="form-control" 
                formControlName="label"
                placeholder="مثال: الرئيسية، عن الكلية"
              >
            </div>
            <div class="form-group">
              <label>الرابط</label>
              <input 
                type="text" 
                class="form-control" 
                formControlName="route"
                placeholder="مثال: /home، /about"
              >
            </div>
            <div class="form-group">
              <label>هدف الرابط</label>
              <select class="form-control" formControlName="target">
                <option value="">نفس النافذة</option>
                <option value="_blank">نافذة جديدة</option>
                <option value="_self">نفس الإطار</option>
                <option value="_parent">الإطار الأب</option>
              </select>
            </div>
            <div class="form-group">
              <label>نوع العنصر</label>
              <select class="form-control" formControlName="parentId">
                <option [value]="null">عنصر رئيسي</option>
                <option *ngFor="let parentItem of navbarItemsArray.controls; let j = index" 
                        [value]="j" 
                        [disabled]="j === i">
                  فرعي من: {{ parentItem.get('label')?.value || 'عنصر ' + (j + 1) }}
                </option>
              </select>
            </div>
          </div>

          <!-- Children Items -->
          <div class="children-section" *ngIf="getNavbarChildrenArray(i).length > 0 || !item.get('parentId')?.value">
            <div class="section-header">
              <h4>العناصر الفرعية</h4>
              <button type="button" class="btn-add-child" (click)="addNavbarChild(i)">
                <i class="pi pi-plus"></i>
                <span>إضافة عنصر فرعي</span>
              </button>
            </div>
            
            <div formArrayName="children" class="children-container">
              <div *ngFor="let child of getNavbarChildrenArray(i).controls; let j = index" [formGroupName]="j" class="child-item">
                <div class="item-header">
                  <div class="item-info">
                    <h5>العنصر الفرعي {{ j + 1 }}</h5>
                    <span class="item-type">فرعي</span>
                  </div>
                  <button type="button" class="btn-remove-child" (click)="removeNavbarChild(i, j)">
                    <i class="pi pi-times"></i>
                  </button>
                </div>
                <div class="form-grid">
                  <div class="form-group">
                    <label>النص المعروض *</label>
                    <input 
                      type="text" 
                      class="form-control" 
                      formControlName="label"
                      placeholder="مثال: قطاع التعليم"
                    >
                  </div>
                  <div class="form-group">
                    <label>الرابط</label>
                    <input 
                      type="text" 
                      class="form-control" 
                      formControlName="route"
                      placeholder="مثال: /sectors/education"
                    >
                  </div>
                  <div class="form-group">
                    <label>هدف الرابط</label>
                    <select class="form-control" formControlName="target">
                      <option value="">نفس النافذة</option>
                      <option value="_blank">نافذة جديدة</option>
                      <option value="_self">نفس الإطار</option>
                      <option value="_parent">الإطار الأب</option>
                    </select>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Submenu Configuration -->
    <div class="form-section" *ngIf="menuForm.get('type')?.value === 'header' && menuForm.get('headerType')?.value === 'submenu'">
      <div class="section-header">
        <h2>إعدادات القائمة الفرعية</h2>
        <p>قم بتكوين القائمة الفرعية مع معلومات الاتصال</p>
      </div>
      
      <div formGroupName="submenu">
        <div class="form-group">
          <label for="copyright">نص حقوق الطبع</label>
          <input 
            id="copyright"
            type="text" 
            class="form-control" 
            formControlName="copyright"
            placeholder="© 2025 كلية الألسن. جميع الحقوق محفوظة."
          >
        </div>
        
        <h3>طرق التواصل</h3>
        <div formGroupName="contactMethods" class="form-grid">
          <div class="form-group">
            <label for="phone">الهاتف</label>
            <input 
              id="phone"
              type="tel" 
              class="form-control" 
              formControlName="phone"
              placeholder="+20 95 237 1000"
            >
          </div>
          <div class="form-group">
            <label for="email">البريد الإلكتروني</label>
            <input 
              id="email"
              type="email" 
              class="form-control" 
              formControlName="email"
              placeholder="info@alsun.luxor.edu.eg"
            >
          </div>
          <div class="form-group">
            <label for="universityWebsite">موقع الجامعة</label>
            <input 
              id="universityWebsite"
              type="url" 
              class="form-control" 
              formControlName="universityWebsite"
              placeholder="https://luxor.edu.eg"
            >
          </div>
        </div>

        <!-- Languages -->
        <div class="subsection">
          <div class="section-header">
            <h3>اللغات المتاحة</h3>
            <button type="button" class="btn-add" (click)="addSubmenuLanguage()">
              <i class="pi pi-plus"></i>
              <span>إضافة لغة</span>
            </button>
          </div>
          <div formArrayName="languages" class="languages-container">
            <div *ngFor="let lang of submenuLanguagesArray.controls; let i = index" [formGroupName]="i" class="language-item">
              <div class="item-header">
                <h4>اللغة {{ i + 1 }}</h4>
                <button type="button" class="btn-remove" (click)="removeSubmenuLanguage(i)">
                  <i class="pi pi-trash"></i>
                </button>
              </div>
              <div class="form-grid">
                <div class="form-group">
                  <label>الرمز *</label>
                  <input 
                    type="text" 
                    class="form-control" 
                    formControlName="value"
                    placeholder="ar"
                  >
                </div>
                <div class="form-group">
                  <label>الاسم *</label>
                  <input 
                    type="text" 
                    class="form-control" 
                    formControlName="label"
                    placeholder="العربية"
                  >
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Footer Configuration -->
    <div class="form-section" *ngIf="menuForm.get('type')?.value === 'footer'">
      <div class="section-header">
        <h2>إعدادات التذييل</h2>
        <p>قم بتكوين التذييل مع المعلومات الأساسية والروابط الاجتماعية</p>
      </div>
      
      <div formGroupName="footerData">
        <!-- Basic Footer Info -->
        <div class="subsection">
          <h3>المعلومات الأساسية</h3>
          <div class="form-grid">
            <div class="form-group">
              <label for="footerTitle">العنوان</label>
              <input 
                id="footerTitle"
                type="text" 
                class="form-control" 
                formControlName="title"
                placeholder="كلية الألسن"
              >
            </div>
            <div class="form-group">
              <label for="footerSubtitle">العنوان الفرعي</label>
              <input 
                id="footerSubtitle"
                type="text" 
                class="form-control" 
                formControlName="subtitle"
                placeholder="جامعة الأقصر"
              >
            </div>
            <div class="form-group">
              <label for="tagline">الشعار</label>
              <input 
                id="tagline"
                type="text" 
                class="form-control" 
                formControlName="tagline"
                placeholder="التميز في تعليم اللغات"
              >
            </div>
            <div class="form-group">
              <label for="footerCopyright">حقوق الطبع</label>
              <input 
                id="footerCopyright"
                type="text" 
                class="form-control" 
                formControlName="copyright"
                placeholder="© 2025 كلية الألسن. جميع الحقوق محفوظة."
              >
            </div>
          </div>
        </div>

        <!-- Social Media Links -->
        <div class="subsection">
          <div class="section-header">
            <h3>روابط وسائل التواصل الاجتماعي</h3>
            <button type="button" class="btn-add" (click)="addFooterSocialLink()">
              <i class="pi pi-plus"></i>
              <span>إضافة رابط اجتماعي</span>
            </button>
          </div>
          <div formArrayName="socialLinks" class="social-links-container">
            <div *ngFor="let link of footerSocialLinksArray.controls; let i = index" [formGroupName]="i" class="social-link-item">
              <div class="item-header">
                <h4>رابط اجتماعي {{ i + 1 }}</h4>
                <button type="button" class="btn-remove" (click)="removeFooterSocialLink(i)">
                  <i class="pi pi-trash"></i>
                </button>
              </div>
              <div class="form-grid">
                <div class="form-group">
                  <label>المنصة *</label>
                  <input 
                    type="text" 
                    class="form-control" 
                    formControlName="platform"
                    placeholder="فيسبوك"
                  >
                </div>
                <div class="form-group">
                  <label>الرابط *</label>
                  <input 
                    type="url" 
                    class="form-control" 
                    formControlName="url"
                    placeholder="https://facebook.com/page"
                  >
                </div>
                <div class="form-group">
                  <label>الأيقونة *</label>
                  <select class="form-control" formControlName="icon">
                    <option value="">اختر الأيقونة</option>
                    <option *ngFor="let icon of socialIcons" [value]="icon.value">
                      {{ icon.label }}
                    </option>
                  </select>
                </div>
                <div class="form-group">
                  <label>هدف الرابط</label>
                  <select class="form-control" formControlName="target">
                    <option value="">نفس النافذة</option>
                    <option value="_blank">نافذة جديدة</option>
                    <option value="_self">نفس الإطار</option>
                    <option value="_parent">الإطار الأب</option>
                  </select>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Quick Links -->
        <div class="subsection">
          <div class="section-header">
            <h3>الروابط السريعة</h3>
            <button type="button" class="btn-add" (click)="addFooterQuickLink()">
              <i class="pi pi-plus"></i>
              <span>إضافة رابط سريع</span>
            </button>
          </div>
          <div formGroupName="quickLinks">
            <div class="form-group">
              <label for="quickLinksTitle">عنوان القسم</label>
              <input 
                id="quickLinksTitle"
                type="text" 
                class="form-control" 
                formControlName="title"
                placeholder="روابط سريعة"
              >
            </div>
            <div formArrayName="links" class="links-container">
              <div *ngFor="let link of footerQuickLinksArray.controls; let i = index" [formGroupName]="i" class="link-item">
                <div class="item-header">
                  <h4>رابط {{ i + 1 }}</h4>
                  <button type="button" class="btn-remove" (click)="removeFooterQuickLink(i)">
                    <i class="pi pi-trash"></i>
                  </button>
                </div>
                <div class="form-grid">
                  <div class="form-group">
                    <label>العنوان *</label>
                    <input 
                      type="text" 
                      class="form-control" 
                      formControlName="title"
                      placeholder="عن الكلية"
                    >
                  </div>
                  <div class="form-group">
                    <label>الرابط *</label>
                    <input 
                      type="text" 
                      class="form-control" 
                      formControlName="url"
                      placeholder="/about"
                    >
                  </div>
                  <div class="form-group">
                    <label>هدف الرابط</label>
                    <select class="form-control" formControlName="target">
                      <option value="">نفس النافذة</option>
                      <option value="_blank">نافذة جديدة</option>
                      <option value="_self">نفس الإطار</option>
                      <option value="_parent">الإطار الأب</option>
                    </select>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Academic Links -->
        <div class="subsection">
          <div class="section-header">
            <h3>الروابط الأكاديمية</h3>
            <button type="button" class="btn-add" (click)="addFooterAcademicLink()">
              <i class="pi pi-plus"></i>
              <span>إضافة رابط أكاديمي</span>
            </button>
          </div>
          <div formGroupName="academicLinks">
            <div class="form-group">
              <label for="academicLinksTitle">عنوان القسم</label>
              <input 
                id="academicLinksTitle"
                type="text" 
                class="form-control" 
                formControlName="title"
                placeholder="الروابط الأكاديمية"
              >
            </div>
            <div formArrayName="links" class="links-container">
              <div *ngFor="let link of footerAcademicLinksArray.controls; let i = index" [formGroupName]="i" class="link-item">
                <div class="item-header">
                  <h4>رابط {{ i + 1 }}</h4>
                  <button type="button" class="btn-remove" (click)="removeFooterAcademicLink(i)">
                    <i class="pi pi-trash"></i>
                  </button>
                </div>
                <div class="form-grid">
                  <div class="form-group">
                    <label>العنوان *</label>
                    <input 
                      type="text" 
                      class="form-control" 
                      formControlName="title"
                      placeholder="الدراسات العليا"
                    >
                  </div>
                  <div class="form-group">
                    <label>الرابط *</label>
                    <input 
                      type="text" 
                      class="form-control" 
                      formControlName="url"
                      placeholder="/postgraduate"
                    >
                  </div>
                  <div class="form-group">
                    <label>هدف الرابط</label>
                    <select class="form-control" formControlName="target">
                      <option value="">نفس النافذة</option>
                      <option value="_blank">نافذة جديدة</option>
                      <option value="_self">نفس الإطار</option>
                      <option value="_parent">الإطار الأب</option>
                    </select>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Resource Links -->
        <div class="subsection">
          <div class="section-header">
            <h3>روابط الموارد</h3>
            <button type="button" class="btn-add" (click)="addFooterResourceLink()">
              <i class="pi pi-plus"></i>
              <span>إضافة رابط مورد</span>
            </button>
          </div>
          <div formGroupName="resourceLinks">
            <div class="form-group">
              <label for="resourceLinksTitle">عنوان القسم</label>
              <input 
                id="resourceLinksTitle"
                type="text" 
                class="form-control" 
                formControlName="title"
                placeholder="الموارد"
              >
            </div>
            <div formArrayName="links" class="links-container">
              <div *ngFor="let link of footerResourceLinksArray.controls; let i = index" [formGroupName]="i" class="link-item">
                <div class="item-header">
                  <h4>رابط {{ i + 1 }}</h4>
                  <button type="button" class="btn-remove" (click)="removeFooterResourceLink(i)">
                    <i class="pi pi-trash"></i>
                  </button>
                </div>
                <div class="form-grid">
                  <div class="form-group">
                    <label>العنوان *</label>
                    <input 
                      type="text" 
                      class="form-control" 
                      formControlName="title"
                      placeholder="المكتبة"
                    >
                  </div>
                  <div class="form-group">
                    <label>الرابط *</label>
                    <input 
                      type="text" 
                      class="form-control" 
                      formControlName="url"
                      placeholder="/library"
                    >
                  </div>
                  <div class="form-group">
                    <label>هدف الرابط</label>
                    <select class="form-control" formControlName="target">
                      <option value="">نفس النافذة</option>
                      <option value="_blank">نافذة جديدة</option>
                      <option value="_self">نفس الإطار</option>
                      <option value="_parent">الإطار الأب</option>
                    </select>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Contact Methods -->
        <div class="subsection">
          <h3>معلومات الاتصال</h3>
          <div formGroupName="contactMethods" class="form-grid">
            <div class="form-group">
              <label for="footerPhone">الهاتف</label>
              <input 
                id="footerPhone"
                type="tel" 
                class="form-control" 
                formControlName="phone"
                placeholder="+20 95 237 1000"
              >
            </div>
            <div class="form-group">
              <label for="footerEmail">البريد الإلكتروني</label>
              <input 
                id="footerEmail"
                type="email" 
                class="form-control" 
                formControlName="email"
                placeholder="info@alsun.luxor.edu.eg"
              >
            </div>
            <div class="form-group">
              <label for="footerUniversityWebsite">موقع الجامعة</label>
              <input 
                id="footerUniversityWebsite"
                type="url" 
                class="form-control" 
                formControlName="universityWebsite"
                placeholder="https://luxor.edu.eg"
              >
            </div>
          </div>

          <!-- Footer Languages -->
          <div class="languages-section">
            <div class="section-header">
              <h4>اللغات المتاحة</h4>
              <button type="button" class="btn-add" (click)="addFooterContactLanguage()">
                <i class="pi pi-plus"></i>
                <span>إضافة لغة</span>
              </button>
            </div>
            <div formArrayName="languages" class="languages-container">
              <div *ngFor="let lang of footerContactLanguagesArray.controls; let i = index" [formGroupName]="i" class="language-item">
                <div class="item-header">
                  <h4>اللغة {{ i + 1 }}</h4>
                  <button type="button" class="btn-remove" (click)="removeFooterContactLanguage(i)">
                    <i class="pi pi-trash"></i>
                  </button>
                </div>
                <div class="form-grid">
                  <div class="form-group">
                    <label>الرمز *</label>
                    <input 
                      type="text" 
                      class="form-control" 
                      formControlName="value"
                      placeholder="ar"
                    >
                  </div>
                  <div class="form-group">
                    <label>الاسم *</label>
                    <input 
                      type="text" 
                      class="form-control" 
                      formControlName="label"
                      placeholder="العربية"
                    >
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Form Actions -->
    <div class="form-actions">
      <button type="button" class="btn-secondary" [routerLink]="['/dashboard/menus']">
        <i class="pi pi-times"></i>
        <span>إلغاء</span>
      </button>
      <button type="submit" class="btn-primary" [disabled]="menuForm.invalid">
        <i class="pi pi-check"></i>
        <span>إنشاء القائمة</span>
      </button>
    </div>
  </form>

  <!-- Toast Messages -->
  <div class="toast-container" *ngIf="showToast">
    <div class="toast" [ngClass]="toastClass">
      <div class="toast-content">
        <i [class]="toastIcon"></i>
        <span>{{ toastMessage }}</span>
      </div>
      <button type="button" class="toast-close" (click)="hideToast()">
        <i class="pi pi-times"></i>
      </button>
    </div>
  </div>
</div>