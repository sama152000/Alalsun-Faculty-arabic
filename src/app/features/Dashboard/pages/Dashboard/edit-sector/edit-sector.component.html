<section class="dashboard-content" dir="rtl">
  <div class="management-header">
    <h2>تعديل القطاع</h2>
  </div>
  <form [formGroup]="sectorForm" (ngSubmit)="saveSector()">
    <div class="tabs">
      <div class="tab-headers">
        <button type="button" class="tab-header" [class.active]="activeTab === 'basic'" (click)="activeTab = 'basic'">
          <i class="pi pi-info-circle"></i> المعلومات الأساسية
        </button>
        <button type="button" class="tab-header" [class.active]="activeTab === 'viceDean'" (click)="activeTab = 'viceDean'">
          <i class="pi pi-user"></i> معلومات وكيل العميد
        </button>
        <button type="button" class="tab-header" [class.active]="activeTab === 'departments'" (click)="activeTab = 'departments'">
          <i class="pi pi-sitemap"></i> الأقسام
        </button>
        <button type="button" class="tab-header" [class.active]="activeTab === 'services'" (click)="activeTab = 'services'">
          <i class="pi pi-check-circle"></i> الخدمات
        </button>
        <button type="button" class="tab-header" [class.active]="activeTab === 'news'" (click)="activeTab = 'news'">
          <i class="pi pi-megaphone"></i> الأخبار والفعاليات
        </button>
        <button type="button" class="tab-header" [class.active]="activeTab === 'media'" (click)="activeTab = 'media'">
          <i class="pi pi-images"></i> الوسائط
        </button>
        <button type="button" class="tab-header" [class.active]="activeTab === 'statistics'" (click)="activeTab = 'statistics'">
          <i class="pi pi-chart-bar"></i> الإحصائيات
        </button>
        <button type="button" class="tab-header" [class.active]="activeTab === 'activities'" (click)="activeTab = 'activities'">
          <i class="pi pi-calendar"></i> الأنشطة
        </button>
        <button type="button" class="tab-header" [class.active]="activeTab === 'achievements'" (click)="activeTab = 'achievements'">
          <i class="pi pi-trophy"></i> الإنجازات
        </button>
      </div>

      <!-- Basic Info Tab -->
      <div class="tab-content" [class.active]="activeTab === 'basic'">
        <div class="form-grid">
          <div class="form-group">
            <label>المعرف *</label>
            <input 
              type="text" 
              class="form-control" 
              formControlName="id"
              placeholder="أدخل معرف القطاع"
            >
          </div>
          <div class="form-group">
            <label>الاسم *</label>
            <input 
              type="text" 
              class="form-control" 
              formControlName="name"
              placeholder="أدخل اسم القطاع"
            >
          </div>
          <div class="form-group">
            <label>العنوان *</label>
            <input 
              type="text" 
              class="form-control" 
              formControlName="title"
              placeholder="أدخل العنوان"
            >
          </div>
          <div class="form-group full-width">
            <label>الوصف *</label>
            <textarea 
              class="form-control" 
              formControlName="description"
              rows="4"
              placeholder="أدخل الوصف"
            ></textarea>
          </div>
          <div class="form-group">
            <label>رابط الصورة</label>
            <input 
              type="url" 
              class="form-control" 
              formControlName="image"
              placeholder="أدخل رابط الصورة"
            >
          </div>
        </div>
      </div>

      <!-- Vice Dean Info Tab -->
      <div class="tab-content" [class.active]="activeTab === 'viceDean'">
        <div class="form-grid" formGroupName="viceDean">
          <div class="form-group">
            <label>الاسم *</label>
            <input
              type="text"
              class="form-control"
              formControlName="name"
              placeholder="أدخل اسم وكيل العميد"
            >
          </div>
          <div class="form-group">
            <label>العنوان *</label>
            <input
              type="text"
              class="form-control"
              formControlName="title"
              placeholder="أدخل العنوان"
            >
          </div>
          <div class="form-group">
            <label>رابط الصورة</label>
            <input
              type="url"
              class="form-control"
              formControlName="photo"
              placeholder="أدخل رابط الصورة"
            >
          </div>
          <div class="form-group">
            <label>البريد الإلكتروني *</label>
            <input
              type="email"
              class="form-control"
              formControlName="email"
              placeholder="أدخل البريد الإلكتروني"
            >
          </div>
          <div class="form-group">
            <label>المكتب</label>
            <input
              type="text"
              class="form-control"
              formControlName="office"
              placeholder="أدخل المكتب"
            >
          </div>
        </div>
      </div>

      <!-- Departments Tab -->
      <div class="tab-content" [class.active]="activeTab === 'departments'">
        <div class="section-header">
          <h4>الأقسام</h4>
          <button 
            type="button"
            class="btn-add-item"
            (click)="addDepartment()"
          >
            <i class="pi pi-plus"></i>
            إضافة قسم
          </button>
        </div>
        <div formArrayName="departments">
          <div 
            *ngFor="let dept of departmentsArray.controls; let i = index"
            [formGroupName]="i"
            class="education-item"
          >
            <div class="item-header">
              <h5>القسم {{ i + 1 }}</h5>
              <button 
                type="button"
                class="btn-remove"
                (click)="removeDepartment(i)"
              >
                <i class="pi pi-trash"></i>
              </button>
            </div>
            <div class="form-grid">
              <div class="form-group">
                <label>المعرف *</label>
                <input 
                  type="text" 
                  class="form-control" 
                  formControlName="id"
                  placeholder="أدخل معرف القسم"
                >
              </div>
              <div class="form-group">
                <label>الاسم *</label>
                <input 
                  type="text" 
                  class="form-control" 
                  formControlName="name"
                  placeholder="أدخل الاسم"
                >
              </div>
              <div class="form-group full-width">
                <label>نظرة عامة *</label>
                <textarea 
                  class="form-control" 
                  formControlName="overview"
                  rows="3"
                  placeholder="أدخل نظرة عامة"
                ></textarea>
              </div>
              <div class="form-group full-width">
                <label>المسؤوليات</label>
                <div formArrayName="responsibilities">
                  <div *ngFor="let resp of getResponsibilities(i).controls; let r = index">
                    <input
                      type="text"
                      class="form-control"
                      [formControlName]="r"
                      placeholder="أدخل المسؤولية"
                    >
                    <button type="button" (click)="removeResponsibility(i, r)">إزالة</button>
                  </div>
                </div>
                <button type="button" (click)="addResponsibility(i)">إضافة مسؤولية</button>
              </div>
              <div formGroupName="contact">
                <div class="form-group">
                  <label>البريد الإلكتروني للتواصل *</label>
                  <input
                    type="email"
                    class="form-control"
                    formControlName="email"
                    placeholder="أدخل البريد الإلكتروني"
                  >
                </div>
                <div class="form-group">
                  <label>مكتب التواصل *</label>
                  <input
                    type="text"
                    class="form-control"
                    formControlName="office"
                    placeholder="أدخل المكتب"
                  >
                </div>
                <div class="form-group">
                  <label>هاتف التواصل</label>
                  <input
                    type="text"
                    class="form-control"
                    formControlName="phone"
                    placeholder="أدخل الهاتف"
                  >
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Services Tab -->
      <div class="tab-content" [class.active]="activeTab === 'services'">
        <div class="section-header">
          <h4>الخدمات</h4>
          <button 
            type="button"
            class="btn-add-item"
            (click)="addService()"
          >
            <i class="pi pi-plus"></i>
            إضافة خدمة
          </button>
        </div>
        <div formArrayName="services">
          <div 
            *ngFor="let serv of servicesArray.controls; let i = index"
            [formGroupName]="i"
            class="education-item"
          >
            <div class="item-header">
              <h5>الخدمة {{ i + 1 }}</h5>
              <button 
                type="button"
                class="btn-remove"
                (click)="removeService(i)"
              >
                <i class="pi pi-trash"></i>
              </button>
            </div>
            <div class="form-grid">
              <div class="form-group">
                <label>المعرف *</label>
                <input 
                  type="text" 
                  class="form-control" 
                  formControlName="id"
                  placeholder="أدخل معرف الخدمة"
                >
              </div>
              <div class="form-group">
                <label>الاسم *</label>
                <input 
                  type="text" 
                  class="form-control" 
                  formControlName="name"
                  placeholder="أدخل الاسم"
                >
              </div>
              <div class="form-group full-width">
                <label>الوصف *</label>
                <textarea 
                  class="form-control" 
                  formControlName="description"
                  rows="3"
                  placeholder="أدخل الوصف"
                ></textarea>
              </div>
              <div class="form-group full-width">
                <label>الخطوات</label>
                <div formArrayName="steps">
                  <div *ngFor="let step of getSteps(i).controls; let s = index">
                    <input 
                      type="text" 
                      class="form-control" 
                      [formControlName]="s"
                      placeholder="أدخل الخطوة"
                    >
                    <button type="button" (click)="removeStep(i, s)">إزالة</button>
                  </div>
                </div>
                <button type="button" (click)="addStep(i)">إضافة خطوة</button>
              </div>
              <div class="form-group full-width">
                <label>الوثائق المطلوبة</label>
                <div formArrayName="requiredDocuments">
                  <div *ngFor="let doc of getRequiredDocuments(i).controls; let d = index">
                    <input 
                      type="text" 
                      class="form-control" 
                      [formControlName]="d"
                      placeholder="أدخل الوثيقة المطلوبة"
                    >
                    <button type="button" (click)="removeRequiredDocument(i, d)">إزالة</button>
                  </div>
                </div>
                <button type="button" (click)="addRequiredDocument(i)">إضافة وثيقة مطلوبة</button>
              </div>
              <div class="form-group full-width">
                <label>النماذج القابلة للتنزيل</label>
                <div formArrayName="downloadableForms">
                  <div *ngFor="let form of getDownloadableForms(i).controls; let f = index">
                    <input 
                      type="text" 
                      class="form-control" 
                      [formControlName]="f"
                      placeholder="أدخل نموذج قابل للتنزيل"
                    >
                    <button type="button" (click)="removeDownloadableForm(i, f)">إزالة</button>
                  </div>
                </div>
                <button type="button" (click)="addDownloadableForm(i)">إضافة نموذج قابل للتنزيل</button>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- News & Events Tab -->
      <div class="tab-content" [class.active]="activeTab === 'news'">
        <div class="section-header">
          <h4>الأخبار والفعاليات</h4>
          <button 
            type="button"
            class="btn-add-item"
            (click)="addNews()"
          >
            <i class="pi pi-plus"></i>
            إضافة خبر
          </button>
        </div>
        <div formArrayName="news">
          <div 
            *ngFor="let news of newsArray.controls; let i = index"
            [formGroupName]="i"
            class="education-item"
          >
            <div class="item-header">
              <h5>الخبر {{ i + 1 }}</h5>
              <button 
                type="button"
                class="btn-remove"
                (click)="removeNews(i)"
              >
                <i class="pi pi-trash"></i>
              </button>
            </div>
            <div class="form-grid">
              <div class="form-group">
                <label>المعرف *</label>
                <input 
                  type="text" 
                  class="form-control" 
                  formControlName="id"
                  placeholder="أدخل معرف الخبر"
                >
              </div>
              <div class="form-group">
                <label>العنوان *</label>
                <input 
                  type="text" 
                  class="form-control" 
                  formControlName="title"
                  placeholder="أدخل العنوان"
                >
              </div>
              <div class="form-group full-width">
                <label>الملخص *</label>
                <textarea 
                  class="form-control" 
                  formControlName="summary"
                  rows="3"
                  placeholder="أدخل الملخص"
                ></textarea>
              </div>
              <div class="form-group">
                <label>التاريخ *</label>
                <input 
                  type="date" 
                  class="form-control" 
                  formControlName="date"
                  placeholder="أدخل التاريخ"
                >
              </div>
              <div class="form-group">
                <label>رابط الصورة</label>
                <input 
                  type="url" 
                  class="form-control" 
                  formControlName="image"
                  placeholder="أدخل رابط الصورة"
                >
              </div>
              <div class="form-group">
                <label>الفئة *</label>
                <input 
                  type="text" 
                  class="form-control" 
                  formControlName="category"
                  placeholder="أدخل الفئة"
                >
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Media Tab -->
      <div class="tab-content" [class.active]="activeTab === 'media'">
        <div class="section-header">
          <h4>الوسائط</h4>
          <button 
            type="button"
            class="btn-add-item"
            (click)="addMedia()"
          >
            <i class="pi pi-plus"></i>
            إضافة وسائط
          </button>
        </div>
        <div formArrayName="media">
          <div 
            *ngFor="let media of mediaArray.controls; let i = index"
            [formGroupName]="i"
            class="education-item"
          >
            <div class="item-header">
              <h5>الوسائط {{ i + 1 }}</h5>
              <button 
                type="button"
                class="btn-remove"
                (click)="removeMedia(i)"
              >
                <i class="pi pi-trash"></i>
              </button>
            </div>
            <div class="form-grid">
              <div class="form-group">
                <label>المعرف *</label>
                <input 
                  type="text" 
                  class="form-control" 
                  formControlName="id"
                  placeholder="أدخل معرف الوسائط"
                >
              </div>
              <div class="form-group">
                <label>العنوان *</label>
                <input 
                  type="text" 
                  class="form-control" 
                  formControlName="title"
                  placeholder="أدخل العنوان"
                >
              </div>
              <div class="form-group">
                <label>النوع *</label>
                <select formControlName="type" class="form-control">
                  <option value="">اختر النوع</option>
                  <option value="photo">صورة</option>
                  <option value="video">فيديو</option>
                  <option value="document">وثيقة</option>
                </select>
              </div>
              <div class="form-group">
                <label>الرابط *</label>
                <input 
                  type="url" 
                  class="form-control" 
                  formControlName="url"
                  placeholder="أدخل الرابط"
                >
              </div>
              <div class="form-group">
                <label>رابط الصورة المصغرة</label>
                <input 
                  type="url" 
                  class="form-control" 
                  formControlName="thumbnail"
                  placeholder="أدخل رابط الصورة المصغرة"
                >
              </div>
              <div class="form-group full-width">
                <label>الوصف</label>
                <textarea 
                  class="form-control" 
                  formControlName="description"
                  rows="3"
                  placeholder="أدخل الوصف"
                ></textarea>
              </div>
              <div class="form-group">
                <label>التاريخ *</label>
                <input 
                  type="date" 
                  class="form-control" 
                  formControlName="date"
                  placeholder="أدخل التاريخ"
                >
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Statistics Tab -->
      <div class="tab-content" [class.active]="activeTab === 'statistics'">
        <div class="section-header">
          <h4>الإحصائيات</h4>
          <button 
            type="button"
            class="btn-add-item"
            (click)="addStatistic()"
          >
            <i class="pi pi-plus"></i>
            إضافة إحصائية
          </button>
        </div>
        <div formArrayName="statistics">
          <div 
            *ngFor="let stat of statisticsArray.controls; let i = index"
            [formGroupName]="i"
            class="education-item"
          >
            <div class="item-header">
              <h5>الإحصائية {{ i + 1 }}</h5>
              <button 
                type="button"
                class="btn-remove"
                (click)="removeStatistic(i)"
              >
                <i class="pi pi-trash"></i>
              </button>
            </div>
            <div class="form-grid">
              <div class="form-group">
                <label>التسمية *</label>
                <input 
                  type="text" 
                  class="form-control" 
                  formControlName="label"
                  placeholder="أدخل التسمية"
                >
              </div>
              <div class="form-group">
                <label>القيمة *</label>
                <input 
                  type="text" 
                  class="form-control" 
                  formControlName="value"
                  placeholder="أدخل القيمة"
                >
              </div>
              <div class="form-group">
                <label>الأيقونة *</label>
                <input 
                  type="text" 
                  class="form-control" 
                  formControlName="icon"
                  placeholder="أدخل الأيقونة (مثل: pi pi-users)"
                >
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Activities Tab -->
      <div class="tab-content" [class.active]="activeTab === 'activities'">
        <div class="section-header">
          <h4>الأنشطة</h4>
          <button 
            type="button"
            class="btn-add-item"
            (click)="addActivity()"
          >
            <i class="pi pi-plus"></i>
            إضافة نشاط
          </button>
        </div>
        <div formArrayName="activities">
          <div 
            *ngFor="let act of activitiesArray.controls; let i = index"
            [formGroupName]="i"
            class="education-item"
          >
            <div class="item-header">
              <h5>النشاط {{ i + 1 }}</h5>
              <button 
                type="button"
                class="btn-remove"
                (click)="removeActivity(i)"
              >
                <i class="pi pi-trash"></i>
              </button>
            </div>
            <div class="form-grid">
              <div class="form-group">
                <label>المعرف *</label>
                <input 
                  type="text" 
                  class="form-control" 
                  formControlName="id"
                  placeholder="أدخل معرف النشاط"
                >
              </div>
              <div class="form-group">
                <label>العنوان *</label>
                <input 
                  type="text" 
                  class="form-control" 
                  formControlName="title"
                  placeholder="أدخل العنوان"
                >
              </div>
              <div class="form-group full-width">
                <label>الوصف *</label>
                <textarea 
                  class="form-control" 
                  formControlName="description"
                  rows="3"
                  placeholder="أدخل الوصف"
                ></textarea>
              </div>
              <div class="form-group">
                <label>التاريخ *</label>
                <input 
                  type="date" 
                  class="form-control" 
                  formControlName="date"
                  placeholder="أدخل التاريخ"
                >
              </div>
              <div class="form-group">
                <label>رابط الصورة</label>
                <input 
                  type="url" 
                  class="form-control" 
                  formControlName="image"
                  placeholder="أدخل رابط الصورة"
                >
              </div>
              <div class="form-group">
                <label>النوع *</label>
                <input 
                  type="text" 
                  class="form-control" 
                  formControlName="type"
                  placeholder="أدخل النوع"
                >
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Achievements Tab -->
      <div class="tab-content" [class.active]="activeTab === 'achievements'">
        <div class="section-header">
          <h4>الإنجازات</h4>
          <button 
            type="button"
            class="btn-add-item"
            (click)="addAchievement()"
          >
            <i class="pi pi-plus"></i>
            إضافة إنجاز
          </button>
        </div>
        <div formArrayName="achievements">
          <div 
            *ngFor="let ach of achievementsArray.controls; let i = index"
            [formGroupName]="i"
            class="education-item"
          >
            <div class="item-header">
              <h5>الإنجاز {{ i + 1 }}</h5>
              <button 
                type="button"
                class="btn-remove"
                (click)="removeAchievement(i)"
              >
                <i class="pi pi-trash"></i>
              </button>
            </div>
            <div class="form-grid">
              <div class="form-group">
                <label>المعرف *</label>
                <input 
                  type="text" 
                  class="form-control" 
                  formControlName="id"
                  placeholder="أدخل معرف الإنجاز"
                >
              </div>
              <div class="form-group">
                <label>العنوان *</label>
                <input 
                  type="text" 
                  class="form-control" 
                  formControlName="title"
                  placeholder="أدخل العنوان"
                >
              </div>
              <div class="form-group full-width">
                <label>الوصف *</label>
                <textarea 
                  class="form-control" 
                  formControlName="description"
                  rows="3"
                  placeholder="أدخل الوصف"
                ></textarea>
              </div>
              <div class="form-group">
                <label>التاريخ *</label>
                <input 
                  type="date" 
                  class="form-control" 
                  formControlName="date"
                  placeholder="أدخل التاريخ"
                >
              </div>
              <div class="form-group">
                <label>رابط الصورة</label>
                <input 
                  type="url" 
                  class="form-control" 
                  formControlName="image"
                  placeholder="أدخل رابط الصورة"
                >
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Form Actions -->
      <div class="dialog-actions">
        <button 
          type="button"
          class="btn-outline-primary-custom"
          [routerLink]="['/dashboard/sectors']"
        >
          إلغاء
        </button>
        <button 
          type="submit"
          class="btn-primary-custom"
          [disabled]="sectorForm.invalid"
        >
          تحديث القطاع
        </button>
      </div>
    </div>
  </form>
</section>

<!-- Toast Messages -->
<div class="toast-container" *ngIf="showToast">
  <div class="toast" [class]="toastClass">
    <div class="toast-content">
      <i [class]="toastIcon"></i>
      <span>{{ toastMessage }}</span>
    </div>
    <button type="button" class="toast-close" (click)="hideToast()">×</button>
  </div>
</div>